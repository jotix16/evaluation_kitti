<launch>
    <!-- Bag nr -->
    <arg name="bag_nr"                default="0_4" />

    <!-- Topics -->
    <arg name="odom_topic_list" default="[/husky_velocity_controller/odom]"/>
    <arg name="imu_topic_list" default="[/imu/data]"/>

    <!-- Frames -->
    <arg name="map_frame"                default="map" />
    <arg name="odom_frame"               default="odom" />
    <arg name="base_link_frame"          default="base_link" />
    <arg name="config_path"              default="$(dirname)/evaluation/bag_$(arg bag_nr)/config.json" />


    <!-- Transformations -->
    <arg name="map_odom_args"            default="0 0 0 0 0 0 $(arg map_frame) $(arg odom_frame)" />
    <arg name="odom_bl_args"             default="0 0 0 0 0 0 $(arg odom_frame) $(arg base_link_frame)" />
    <arg name="bl_imu_args"              default="0 -0.3 0.52 -1.570796327 0 1.570796327 $(arg base_link_frame) imu_link" />

    <!-- Publish Transformations -->
    <node pkg="tf2_ros" type="static_transform_publisher" name="map_odom"  args="$(arg map_odom_args)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="odom_bl" args="$(arg odom_bl_args)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_imu" args="$(arg bl_imu_args)" />


    <node name="filter_node" pkg="LocalizationFusionLibrary" type="filter_ros_node" output="screen">
      <param name="config" value="$(arg config_path)"/>
      <param name="map_frame" value="$(arg map_frame)"/>
      <param name="odom_frame" value="$(arg odom_frame)"/>
      <param name="base_link_frame" value="$(arg base_link_frame)"/>

      <rosparam param="odom_topics" subst_value="True">$(arg odom_topic_list)</rosparam>
      <rosparam param="imu_topics" subst_value="True">$(arg imu_topic_list)</rosparam>
</node>
</launch>
