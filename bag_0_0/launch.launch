<launch>
    <param name="/use_sim_time" value="true" />
    <!-- Bag nr -->
    <arg name="bag_nr"                default="0" />

    <!-- Topics -->
<<<<<<< HEAD
    <!-- <arg name="odom_topic_list" default="[/rtabmap/odom]"/> -->
    <arg name="odom_topic_list" default="[/loam]"/>
=======
    <arg name="odom_topic_list" default="[/odom]"/>
>>>>>>> 3dd3c5c3163cf443bb759576897c2f29ff36b064
    <arg name="imu_topic_list" default="[/kitti/oxts/imu]"/>

    <!-- Frames -->
    <arg name="map_frame"                default="map" />
    <arg name="odom_frame"               default="odom" />
<<<<<<< HEAD
    <arg name="base_link_frame"          default="base_link" />
=======
    <arg name="base_link_frame"          default="baselink" />
>>>>>>> 3dd3c5c3163cf443bb759576897c2f29ff36b064
    <arg name="config_path"              default="$(dirname)/config.json" />

    <!-- Transformations -->
    <arg name="pi/2" value="1.5707963267948966" />
    <arg name="map_odom_args"            default="0 0 0 0 0 0 $(arg map_frame) $(arg odom_frame)" />
    <arg name="odom_bl_args"             default="0 0 0 0 0 0 $(arg odom_frame) $(arg base_link_frame)" />
<<<<<<< HEAD
    <arg name="bl_imu_args"              default="-1.405 0.32 0.93 0 0 0 $(arg base_link_frame) imu_link" />
    <arg name="bl_lidar_args" value="0 0 0 $(arg pi/2) 0 $(arg pi/2)" />
=======
    <arg name="bl_imu_args"              default="-1.5658062401186161 0.0007247182724307247 -1.5878764343959821 0 0 0 $(arg base_link_frame) imu_link" />
>>>>>>> 3dd3c5c3163cf443bb759576897c2f29ff36b064

    <!-- Publish Transformations -->
    <node pkg="tf2_ros" type="static_transform_publisher" name="map_odom"  args="$(arg map_odom_args)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="odom_bl" args="$(arg odom_bl_args)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_imu" args="$(arg bl_imu_args)" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_lidar" args="$(arg bl_lidar_args) $(arg base_link_frame) lidar" />

    <arg name="bag_play"        default="true" />
    <arg if="$(arg bag_play)"   name="bag_play_args" default="$(dirname)/bag/laser_odom.bag --clock -d 5 -s 0" />
    <node if="$(arg bag_play)" pkg="rosbag" type="play" name="rosbagplay" args=" $(arg bag_play_args)" required="true" output="screen" />

    <arg name="rviz"            default="false" />
    <arg if="$(arg rviz)"       name="rviz_args"     default="$(dirname)/config.rviz" />
    <node if="$(arg rviz)" type="rviz" name="rviz" pkg="rviz" args="-d $(arg rviz_args)" />

    <arg name="bag_record"      default="true" />
    <arg if="$(arg bag_record)" name="topics_record"  default="/odometry/filtered" />
    <arg if="$(arg bag_record)" name="out_path"  default="$(dirname)/bag/loc_lib.bag" />
    <arg if="$(arg bag_record)" name="bag_record_args"  default="$(arg topics_record) -O $(arg out_path)" />
    <node if="$(arg bag_record)" pkg="rosbag" type="record" name="rosbagrecord" args=" $(arg bag_record_args)" required="true" output="screen" />

    <arg name="bag_play"        default="true" />
    <arg if="$(arg bag_play)"   name="bag_play_args" default="$(dirname)/bag/seq_$(arg bag_nr).bag" />
    <node if="$(arg bag_play)" pkg="rosbag" type="play" name="rosbagplay" args=" $(arg bag_play_args) --clock -d 5 -s 0 " required="true" output="screen"/>

    <arg name="rviz"            default="true" />
    <arg if="$(arg rviz)"       name="rviz_args"     default="$(dirname)/config.rviz" />
    <node if="$(arg rviz)" type="rviz" name="rviz" pkg="rviz" args="-d $(arg rviz_args)" />

    <arg name="bag_record"      default="true" />
    <arg if="$(arg bag_record)" name="topics_record"  default="/odometry/filtered" />
    <arg if="$(arg bag_record)" name="out_path"  default="$(dirname)/bag/loc_lib.bag" />
    <arg if="$(arg bag_record)" name="bag_record_args"  default="$(arg topics_record) -O $(arg out_path)" />
    <node if="$(arg bag_record)" pkg="rosbag" type="record" name="rosbagrecord" args=" $(arg bag_record_args)" required="true" output="screen" />


    <node name="filter_node" pkg="LocalizationFusionLibrary" type="filter_ros_node" output="screen" clear_params="true">
      <param name="config" value="$(arg config_path)"/>
      <param name="map_frame" value="$(arg map_frame)"/>
      <param name="odom_frame" value="$(arg odom_frame)"/>
      <param name="base_link_frame" value="$(arg base_link_frame)"/>

      <rosparam param="odom_topics" subst_value="True">$(arg odom_topic_list)</rosparam>
<<<<<<< HEAD
      <!-- <rosparam param="imu_topics" subst_value="True">$(arg imu_topic_list)</rosparam> -->
=======
      <rosparam param="imu_topics" subst_value="True">$(arg imu_topic_list)</rosparam>
>>>>>>> 3dd3c5c3163cf443bb759576897c2f29ff36b064
    </node>
</launch>
